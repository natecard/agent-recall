{
  "project": "Agent Recall Super Ralph",
  "version": 2,
  "selection_policy": {
    "agent_decides_priority": true,
    "priority_scale": "1 = highest priority",
    "order_of_operations": [
      "critical bugfixes",
      "tracer-bullet feature slices",
      "polish and quick wins",
      "refactors"
    ]
  },
  "items": [
    {
      "id": "AR-707",
      "priority": 1,
      "title": "OpenCode Plugin Integration",
      "description": "Implement Ralph as an OpenCode plugin that subscribes to session lifecycle events (session start, idle, tool use). This enables the same hook-based workflow that Claude Code provides, but for the OpenCode ecosystem.",
      "user_story": "As a developer using OpenCode, I want Ralph to react to my coding sessions just like it does with Claude Code hooks.",
      "steps": [
        "Research OpenCode plugin API and subscription model",
        "Implement plugin that subscribes to session events",
        "Forward events to Ralph iteration store",
        "Add `ralph plugin opencode install` command",
        "Add TUI action for OpenCode plugin management"
      ],
      "acceptance_criteria": [
        "OpenCode plugin receives session lifecycle events",
        "Events are forwarded to Ralph's iteration store",
        "Plugin installation and removal are idempotent",
        "Tests cover event subscription and forwarding"
      ],
      "validation_commands": [
        "uv run pytest tests/ -k opencode_plugin -x --tb=short"
      ],
      "passes": true
    },
    {
      "id": "AR-1001",
      "priority": 2,
      "title": "Refactor Dashboard to Component Architecture",
      "description": "Refactor the monolithic `build_tui_dashboard` function into separate, reusable Textual `Widget` classes for each logical section (Knowledge, LLM, Sources, Settings, Timeline). This moves away from the current method of rendering static Rich groups on every tick to a component-based model where widgets manage their own state and updates. This is a prerequisite for adding interactivity and fixing the 'All' view.",
      "user_story": "As a developer extending the TUI, I want clear separation of concerns in the dashboard code so that I can add features to the Timeline or Settings views without navigating a single 300-line function.",
      "steps": [
        "Create `src/agent_recall/cli/tui/widgets/` package",
        "Implement `KnowledgeWidget`, `LLMConfigWidget`, `SourcesWidget`, `SettingsWidget`, `TimelineWidget` inheriting from `Static` or `Widget`",
        "Move rendering logic from `dashboard.py` into `render()` or `compose()` methods of these widgets",
        "Update `AgentRecallTextualApp` to compose these widgets instead of calling `build_tui_dashboard`",
        "Implement a `DashboardController` or update `app.py` to coordinate data refreshes to these widgets"
      ],
      "acceptance_criteria": [
        "Dashboard views render identically to the current implementation but use Widget classes",
        "`build_tui_dashboard` function is deprecated or removed",
        "Code is split into multiple files in `widgets/`",
        "Individual widgets can be refreshed independently",
        "Tests pass with new component structure"
      ],
      "validation_commands": ["uv run pytest tests/test_textual_tui.py"],
      "passes": true
    },
    {
      "id": "AR-1002",
      "priority": 1,
      "title": "Refactor 'All View' to Responsive Grid Layout",
      "description": "Replace the static vertical stacking in the 'All' view with a proper CSS Grid layout. The current implementation forces a rigid 2-column row structure. A grid layout should adapt to the terminal window size, allowing for a more information-dense and readable dashboard. The 'All' view should effectively become a high-level cockpit.",
      "user_story": "As a user with a large terminal window, I want the 'All' view to utilize the available space efficiently, showing me the timeline, status, and config side-by-side rather than in a long scrolling list.",
      "steps": [
        "Define a CSS Grid layout in `APP_CSS` for the 'All' view",
        "Update `AgentRecallTextualApp` to switch classes/layouts when 'All' view is active",
        "Place `TimelineWidget` in a primary column (e.g., center or right) taking up vertically available space",
        "Place `Status`, `Sources`, and `Config` widgets in a sidebar or secondary column",
        "Ensure layout degrades gracefully on smaller screens"
      ],
      "acceptance_criteria": [
        "All View uses CSS Grid instead of `_two_panel_row` helper",
        "Layout adapts to terminal width (e.g., switches to storage stack on narrow screens)",
        "Timeline is visible without scrolling the entire dashboard",
        "All key information is visible at a glance on standard 1080p terminal sizes"
      ],
      "validation_commands": ["uv run pytest tests/test_textual_tui.py"],
      "passes": true
    },
    {
      "id": "AR-1003",
      "priority": 1,
      "title": "Interactive Configuration & Sources Views",
      "description": "Upgrade the read-only Settings, LLM, and Sources views to be interactive. Users should be able to toggle settings, change models, and trigger source syncs directly from the UI without editing text files or restarting. This addresses the need for simple accessibility to common tasks.",
      "user_story": "As a user, I want to quickly switch LLM models or trigger a manual sync of a source within the TUI so that I can experiment with different configurations rapidly.",
      "steps": [
        "Convert `LLMConfigWidget` to use `Input` and `Select` widgets for provider/model/temperature",
        "Convert `SourcesWidget` to use `DataTable` or `ListView` with 'Sync' buttons",
        "Implement message passing or callbacks to update the underlying configuration/trigger syncs",
        "Add visual feedback (spinners/notifications) for sync actions"
      ],
      "acceptance_criteria": [
        "Users can edit LLM configuration in the UI and changes are persisted",
        "Users can click a button to sync a specific source",
        "Sources view shows real-time status of sync operations",
        "Settings view allows toggling boolean flags (e.g., refresh rate, theme)"
      ],
      "validation_commands": ["uv run pytest tests/test_textual_tui.py"],
      "passes": true
    },
    {
      "id": "AR-1004",
      "priority": 1,
      "title": "Enhanced Knowledge & Timeline Browsers",
      "description": "Transform the static Knowledge and Timeline summaries into fully browsable interfaces. The Knowledge view should allow reading the actual Guardrails/Style/Recent content with syntax highlighting. The Timeline should allow clicking an entry to view the full iteration report and diff.",
      "user_story": "As a user, I want to read my Guardrails or review a past iteration's diff within the TUI so that I don't have to switch to an external editor.",
      "steps": [
        "Implement `KnowledgeBrowser` widget with tabs for Guardrails/Style/Recent",
        "Use `RichLog` or `Syntax` widget to display file content with scrolling",
        "Make `TimelineWidget` items clickable (using `DataTable` or custom buttons)",
        "Implement a `DetailModal` or side-sheet to show the full content of a selected timeline item (report + diff)",
        "Add search/filter input for the Timeline"
      ],
      "acceptance_criteria": [
        "Knowledge view displays full content of tier files",
        "Timeline items are interactive; clicking opens details",
        "Detail view shows iteration summary, result, and git diff",
        "Users can escape back to the main view easily"
      ],
      "validation_commands": ["uv run pytest tests/test_textual_tui.py"],
      "passes": true
    },
    {
      "id": "AR-1005",
      "priority": 1,
      "title": "Ralph Status View & Loop Visualization",
      "description": "Create a dedicated 'Ralph' view in the TUI (or integration into the 'All' view) to visualize the current state of the Ralph loop. This view should display real-time information about the active iteration, including the PRD item being worked on, the current phase (planning/coding/validating), and recent activity. It should source data from `.agent/ralph/iterations/current.json` for live state and `ralph_state.json` for historical context.",
      "user_story": "As a user running long autonomous loops, I want to see exactly which PRD item Ralph is working on and its current progress without having to grep through log files.",
      "steps": [
        "Create `src/agent_recall/cli/tui/widgets/ralph.py` with a `RalphStatusWidget` class",
        "Update `DashboardPanels` in `dashboard.py` to include a `ralph` field",
        "Modify `build_dashboard_panels` to instantiate `RalphStatusWidget` and generate the panel",
        "Update `AgentRecallTextualApp` (`app.py`) to support a new `ralph` view and mount the panel",
        "Implement logic in `RalphStatusWidget` to read `.agent/ralph/iterations/current.json` for active iteration details",
        "Add fallback logic to read `ralph_state.json` for idle status and last run summary",
        "Add a 'Ralph Status' command to the TUI command palette to switch to this view"
      ],
      "acceptance_criteria": [
        "A new 'Ralph' view is accessible in the TUI",
        "When running, the view displays: Current Iteration #, Max Iterations, PRD Item ID & Title",
        "When idle, the view displays: Last Run Timestamp, Last Outcome, Total Iterations",
        "The view updates automatically as the loop progresses (via dashboard refresh)",
        "The UI clearly distinguishes between 'Running' and 'Idle' states"
      ],
      "validation_commands": ["uv run pytest tests/test_textual_tui.py"],
      "passes": true
    }
  ]
}
